import React, { useEffect } from 'react'
import Head from 'next/head';
import TopHeader from '../../widgets/TopHeader';
import { useRouter } from 'next/router';
import { seoDefaults } from '../../../constants/seoDefaults';
import Footer from '../../widgets/Footer';
import { useSelector } from 'react-redux';
import { fetchConfig } from '../../../resources/getEnvConfig';
// Language Constants
const SUPPORTED_LANGUAGES = {
  EN: 'en',
  ZH: 'zh',
  RU: 'ru',
  ES: 'es',
  TR: 'tr',
  AR: 'ar',
  IT: 'it'
};
// Social Media Links
const SOCIAL_MEDIA = {
  twitter: "https://x.com/Airport_Pickups",
  instagram: "https://www.instagram.com/airport_pickups_london",
  facebook: "https://www.facebook.com/AirportPickupsLondon"
};
// Meta Content for all languages
const META_CONTENT = {
  en: {
    ogTitle: "Airport Pickups London | Reliable Airport Taxi & Transfer Service",
    ogDescription: "Airport Pickups London offers reliable, professional, and hassle-free airport transfers across London, including Heathrow, Gatwick, Stansted, Luton, and City Airport. Book online for stress-free travel.",
    twitterTitle: "Airport Pickups London | Reliable Airport Taxi & Transfer Service",
    twitterDescription: "Reliable airport taxi transfers across London from Heathrow, Gatwick, Stansted, and Luton. Book now for professional service and stress-free travel."
  },
  tr: {
    ogTitle: "Airport Pickups London | Güvenilir Havalimanı Taksi ve Transfer Hizmeti",
    ogDescription: "Airport Pickups London, Heathrow, Gatwick, Stansted, Luton ve City Havalimanları için güvenilir ve profesyonel havaalanı transfer hizmetleri sunar. Stresiz bir seyahat için şimdi rezervasyon yapın.",
    twitterTitle: "Airport Pickups London | Güvenilir Havalimanı Taksi ve Transfer Hizmeti",
    twitterDescription: "Heathrow, Gatwick, Stansted ve Luton'dan profesyonel havaalanı taksi transferleri. Şimdi stresiz bir yolculuk için rezervasyon yapın."
  },
  ar: {
    ogTitle: "Airport Pickups London | خدمة تاكسي ونقل موثوقة من المطار",
    ogDescription: "تقدم Airport Pickups London خدمات نقل موثوقة ومهنية وخالية من المتاعب من مطارات لندن بما في ذلك هيثرو، جاتويك، ستانستيد، لوتون و City Airport. احجز الآن لرحلة خالية من القلق.",
    twitterTitle: "Airport Pickups London | خدمة تاكسي ونقل موثوقة من المطار",
    twitterDescription: "نقل تاكسي موثوق من مطارات لندن: هيثرو، جاتويك، ستانستيد، ولوتون. احجز الآن لرحلة خالية من المتاعب."
  },
  es: {
    ogTitle: "Airport Pickups London | Servicio de taxi y traslado fiable del aeropuerto",
    ogDescription: "Airport Pickups London ofrece traslados fiables, profesionales y sin complicaciones desde los aeropuertos de Londres, incluidos Heathrow, Gatwick, Stansted, Luton y City Airport. Reserve ahora para un viaje sin estrés.",
    twitterTitle: "Airport Pickups London | Servicio de taxi y traslado fiable del aeropuerto",
    twitterDescription: "Traslados en taxi confiables desde Heathrow, Gatwick, Stansted y Luton. Reserve ahora para un viaje sin estrés."
  },
  it: {
    ogTitle: "Airport Pickups London | Servizio di taxi e trasferimento affidabile dall'aeroporto",
    ogDescription: "Airport Pickups London offre trasferimenti aeroportuali affidabili, professionali e senza problemi da Heathrow, Gatwick, Stansted, Luton e City Airport. Prenota ora per un viaggio senza stress.",
    twitterTitle: "Airport Pickups London | Servizio di taxi e trasferimento affidabile dall'aeroporto",
    twitterDescription: "Trasferimenti in taxi affidabili da Heathrow, Gatwick, Stansted e Luton. Prenota ora per un viaggio senza stress."
  },
  ru: {
    ogTitle: "Airport Pickups London | Надежный такси-сервис и трансферы из аэропорта",
    ogDescription: "Airport Pickups London предлагает надежные, профессиональные и удобные трансферы из аэропортов Лондона, включая Хитроу, Гатвик, Станстед, Лутон и City Airport. Забронируйте сейчас для беспроблемной поездки.",
    twitterTitle: "Airport Pickups London | Надежный такси-сервис и трансферы из аэропорта",
    twitterDescription: "Надежные и удобные такси-трансферы из аэропортов Лондона: Хитроу, Гатвик, Станстед и Лутон. Забронируйте сейчас для беспроблемной поездки."
  },
  zh: {
    ogTitle: "Airport Pickups London | 可靠的机场出租车及接送服务",
    ogDescription: "Airport Pickups London 提供从伦敦希思罗机场、盖特威克机场、斯坦斯特德机场、卢顿机场及City机场的可靠、专业、无忧接送服务。现在预订，享受无忧旅程。",
    twitterTitle: "Airport Pickups London | 可靠的机场出租车及接送服务",
    twitterDescription: "从伦敦的希思罗、盖特威克、斯坦斯特德及卢顿机场提供的可靠出租车接送服务。现在预订，享受无忧旅程。"
  }
};
// Verification Constants
const SITE_VERIFICATIONS = {
  verify_v1: "KKDrUvNuL/YKcQ6PqTYbnH+UUOq0/lz/pJU/z7M+Ro4=",
  baidu: "x5apENcEmp",
  google: "_Cn8CYgXUWiRe05oCJj_l5OkyXza4K4nIuDWUPs8P2w",
  ms: "41FC097AFD6E06774C838AC3D486664F"
};
const GlobalLayout = ({ children, title = seoDefaults.title, description = seoDefaults.description, keywords = seoDefaults.keywords, footerbggray = seoDefaults.footerbggray, isVisible = seoDefaults.isVisible }) => {

  const currentYear = new Date().getFullYear(); // Get the current year
  const router = useRouter()
  const state = useSelector(state => state.pickUpDropOffActions)
  let { params: { language } } = state
  // Fetch environment config for dynamic URL
  const [envConfig, setEnvConfig] = React.useState(null);
  // Utility function for meta tags
  const getLanguageMetaTags = (lang = 'en', domain) => {
    if (!META_CONTENT[lang] || router.pathname !== '/') return null;

    return (
      <>
        <meta property="og:title" content={META_CONTENT[lang].ogTitle} />
        <meta property="og:description" content={META_CONTENT[lang].ogDescription} />
        <meta name="twitter:title" content={META_CONTENT[lang].twitterTitle} />
        <meta name="twitter:description" content={META_CONTENT[lang].twitterDescription} />
      </>
    );
  };
  useEffect(() => {
    async function fetchEnvData() {
      const env = await fetchConfig();
      setEnvConfig(env);
    }
    fetchEnvData();
  }, []);
  useEffect(() => {
    // Remove old meta tags
    const existingKeywords = document.querySelector('meta[name="keywords"]');
    const existingDescription = document.querySelector('meta[name="description"]');
    if (existingKeywords) existingKeywords.remove();
    if (existingDescription) existingDescription.remove();
  }, [description, keywords])

  if (!envConfig) {
    return null; // Prevent rendering until envConfig is fetched
  }

  const websiteDomain = envConfig.websiteDomain;
  console.log(router.pathname);

  return (
    <>
      <Head>
        <title>{title}</title>
        <meta key="keywords" name="keywords" content={keywords} />
        <meta key="description" name="description" content={description} />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1 " />
        <meta httpEquiv="Content-Type" content="text/html; charset=UTF-8" />

        {/* //?Site Verifications */}
        <meta name="verify-v1" content={SITE_VERIFICATIONS.verify_v1} />
        <meta name="baidu-site-verification" content={SITE_VERIFICATIONS.baidu} />
        <meta name="google-site-verification" content={SITE_VERIFICATIONS.google} />
        <meta name="msvalidate.01" content={SITE_VERIFICATIONS.ms} />

        {/* //?Standard Meta Tags */}
        <meta name="distribution" content="Global" />
        <meta name="copyright" content={`Copyright Airport-pickups-london.com ${currentYear}. All rights reserved.`} />
        <meta name="resource-type" content="document" />
        <meta name="author" content="Airport-pickups-london.com" />
        <meta name="language" content="en" />

        {/*//?Browser Compatibility */}
        <meta httpEquiv="X-UA-Compatible" content="IE=9" />
        <meta httpEquiv="x-ua-compatible" content="IE=EmulateIE9" />

        {router.pathname === '/' && (
          <>
            {/* //?Language Alternates */}
            <link rel="canonical" href={language === 'en' ? `${websiteDomain}/` : `${websiteDomain}/${language}`} />
            {Object.values(SUPPORTED_LANGUAGES).map(lang => (
              <link key={lang} rel="alternate" hrefLang={lang} href={`${websiteDomain}/${lang}`} />
            ))}
            <link rel="alternate" hrefLang="x-default" href={`${websiteDomain}/`} />

            {/* //?Open Graph Tags */}
            <meta property="og:type" content="website" />
            <meta property="og:url" content={language === 'en' ? `${websiteDomain}/` : `${websiteDomain}/${language}`} />
            <meta property="og:image" content={`${websiteDomain}/images/homeScreenImage.webp`} />
            <meta property="og:site_name" content="Airport Pickups London" />

            {/* //?Twitter Cards */}
            <meta name="twitter:card" content="summary_large_image" />
            <meta name="twitter:site" content="@Airport_Pickups" />
            <meta name="twitter:image" content={`${websiteDomain}/images/homeScreenImage.webp`} />
          </>
        )}

        {/* //?Language Specific Meta Tags */}
        {getLanguageMetaTags(language, websiteDomain)}

        {/* //?Structured Data */}
        <script type="application/ld+json">
          {JSON.stringify({
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": "Airport Pickups London",
            "url": `${language === "en" ? websiteDomain : `${websiteDomain}/${language}`}`,
            "sameAs": Object.values(SOCIAL_MEDIA),
            "inLanguage": { language }
          }, null, 2)}
        </script>

        {/*//?no follow  */}
        <meta name="googlebot" content="noindex" />
        <meta name="robots" content="noindex" />
        {/* //?Resources */}
        <link rel="preload" href="/images/others/advisorTrip.webp" as="image" type="image/webp" />
        {(router.pathname === "/") ? <link rel="stylesheet" href="/fontawesome/css/all.min.css" /> : <link rel="stylesheet" href="/fontawesomeAll/css/all.min.css" />}

        {
          router.pathname === '/terms' && (
            <>
              <link rel="canonical" href={`${websiteDomain}/terms`} />
              <link rel="alternate" hreflang="tr" href={`${websiteDomain}/tr/terms`} />
              <link rel="alternate" hreflang="ar" href={`${websiteDomain}/ar/terms`} />
              <link rel="alternate" hreflang="es" href={`${websiteDomain}/es/terms`} />
              <link rel="alternate" hreflang="it" href={`${websiteDomain}/it/terms`} />
              <link rel="alternate" hreflang="ru" href={`${websiteDomain}/ru/terms`} />
              <link rel="alternate" hreflang="zh" href={`${websiteDomain}/zh/terms`} />
              <link rel="alternate" hrefLang="x-default" href={`${websiteDomain}/terms`} />
            </>)}
        {
          router.pathname === '/privacy-policy' && (
            <>
              <link rel="canonical" href={`${websiteDomain}/privacy-policy`} />
              <link rel="alternate" hreflang="tr" href={`${websiteDomain}/tr/privacy-policy`} />
              <link rel="alternate" hreflang="ar" href={`${websiteDomain}/ar/privacy-policy`} />
              <link rel="alternate" hreflang="es" href={`${websiteDomain}/es/privacy-policy`} />
              <link rel="alternate" hreflang="it" href={`${websiteDomain}/it/privacy-policy`} />
              <link rel="alternate" hreflang="ru" href={`${websiteDomain}/ru/privacy-policy`} />
              <link rel="alternate" hreflang="zh" href={`${websiteDomain}/zh/privacy-policy`} />
              <link rel="alternate" hrefLang="x-default" href={`${websiteDomain}/privacy-policy`} />
            </>)}
        {
          router.pathname === '/about-us' && (
            <>
              <link rel="canonical" href={`${websiteDomain}/about-us`} />
              <link rel="alternate" hreflang="tr" href={`${websiteDomain}/tr/about-us`} />
              <link rel="alternate" hreflang="ar" href={`${websiteDomain}/ar/about-us`} />
              <link rel="alternate" hreflang="es" href={`${websiteDomain}/es/about-us`} />
              <link rel="alternate" hreflang="it" href={`${websiteDomain}/it/about-us`} />
              <link rel="alternate" hreflang="ru" href={`${websiteDomain}/ru/about-us`} />
              <link rel="alternate" hreflang="zh" href={`${websiteDomain}/zh/about-us`} />
              <link rel="alternate" hrefLang="x-default" href={`${websiteDomain}/about-us`} />

            </>)}

        {
          router.pathname === '/fleet' && (
            <>
              <link rel="canonical" href={`${websiteDomain}/fleet`} />
              <link rel="alternate" hreflang="tr" href={`${websiteDomain}/tr/fleet`} />
              <link rel="alternate" hreflang="ar" href={`${websiteDomain}/ar/fleet`} />
              <link rel="alternate" hreflang="es" href={`${websiteDomain}/es/fleet`} />
              <link rel="alternate" hreflang="it" href={`${websiteDomain}/it/fleet`} />
              <link rel="alternate" hreflang="ru" href={`${websiteDomain}/ru/fleet`} />
              <link rel="alternate" hreflang="zh" href={`${websiteDomain}/zh/fleet`} />
              <link rel="alternate" hrefLang="x-default" href={`${websiteDomain}/fleet`} />

            </>)}

        {
          router.pathname === '/travel-agents' && (
            <>
              <link rel="canonical" href={`${websiteDomain}/travel-agents`} />
              <link rel="alternate" hreflang="tr" href={`${websiteDomain}/tr/travel-agents`} />
              <link rel="alternate" hreflang="ar" href={`${websiteDomain}/ar/travel-agents`} />
              <link rel="alternate" hreflang="es" href={`${websiteDomain}/es/travel-agents`} />
              <link rel="alternate" hreflang="it" href={`${websiteDomain}/it/travel-agents`} />
              <link rel="alternate" hreflang="ru" href={`${websiteDomain}/ru/travel-agents`} />
              <link rel="alternate" hreflang="zh" href={`${websiteDomain}/zh/travel-agents`} />
              <link rel="alternate" hrefLang="x-default" href={`${websiteDomain}/travel-agents`} />

            </>)}
        {
          router.pathname === '/tours' && (
            <>
              <link rel="canonical" href={`${websiteDomain}/tours`} />
              <link rel="alternate" hreflang="tr" href={`${websiteDomain}/tr/tours`} />
              <link rel="alternate" hreflang="ar" href={`${websiteDomain}/ar/tours`} />
              <link rel="alternate" hreflang="es" href={`${websiteDomain}/es/tours`} />
              <link rel="alternate" hreflang="it" href={`${websiteDomain}/it/tours`} />
              <link rel="alternate" hreflang="ru" href={`${websiteDomain}/ru/tours`} />
              <link rel="alternate" hreflang="zh" href={`${websiteDomain}/zh/tours`} />
              <link rel="alternate" hrefLang="x-default" href={`${websiteDomain}/tours`} />
            </>)}
        {
          router.pathname === '/heathrow-porter-service' && (
            <>
              <link rel="canonical" href={`${websiteDomain}/heathrow-porter-service`} />
              <link rel="alternate" hreflang="tr" href={`${websiteDomain}/tr/heathrow-porter-service`} />
              <link rel="alternate" hreflang="ar" href={`${websiteDomain}/ar/heathrow-porter-service`} />
              <link rel="alternate" hreflang="es" href={`${websiteDomain}/es/heathrow-porter-service`} />
              <link rel="alternate" hreflang="it" href={`${websiteDomain}/it/heathrow-porter-service`} />
              <link rel="alternate" hreflang="ru" href={`${websiteDomain}/ru/heathrow-porter-service`} />
              <link rel="alternate" hreflang="zh" href={`${websiteDomain}/zh/heathrow-porter-service`} />
              <link rel="alternate" hrefLang="x-default" href={`${websiteDomain}/heathrow-porter-service`} />
            </>)}

        {
          router.pathname === '/heathrow-vip-meet-and-assist' && (
            <>
              <link rel="canonical" href={`${websiteDomain}/heathrow-vip-meet-and-assist`} />
              <link rel="alternate" hreflang="tr" href={`${websiteDomain}/tr/heathrow-vip-meet-and-assist`} />
              <link rel="alternate" hreflang="ar" href={`${websiteDomain}/ar/heathrow-vip-meet-and-assist`} />
              <link rel="alternate" hreflang="es" href={`${websiteDomain}/es/heathrow-vip-meet-and-assist`} />
              <link rel="alternate" hreflang="it" href={`${websiteDomain}/it/heathrow-vip-meet-and-assist`} />
              <link rel="alternate" hreflang="ru" href={`${websiteDomain}/ru/heathrow-vip-meet-and-assist`} />
              <link rel="alternate" hreflang="zh" href={`${websiteDomain}/zh/heathrow-vip-meet-and-assist`} />
              <link rel="alternate" hrefLang="x-default" href={`${websiteDomain}/heathrow-vip-meet-and-assist`} />
            </>)}

        {
          router.pathname === '/contact-us' && (
            <>
              <link rel="canonical" href={`${websiteDomain}/contact-us`} />
              <link rel="alternate" hreflang="tr" href={`${websiteDomain}/tr/contact-us`} />
              <link rel="alternate" hreflang="ar" href={`${websiteDomain}/ar/contact-us`} />
              <link rel="alternate" hreflang="es" href={`${websiteDomain}/es/contact-us`} />
              <link rel="alternate" hreflang="it" href={`${websiteDomain}/it/contact-us`} />
              <link rel="alternate" hreflang="ru" href={`${websiteDomain}/ru/contact-us`} />
              <link rel="alternate" hreflang="zh" href={`${websiteDomain}/zh/contact-us`} />
              <link rel="alternate" hrefLang="x-default" href={`${websiteDomain}/contact-us`} />
            </>)}
      </Head>
      <TopHeader />

      <main>
        {children}
      </main>
      <Footer bggray={footerbggray} />
    </>
  )
}

export default GlobalLayout
